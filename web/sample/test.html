<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한글이와 함께 - 특수 아동 한국어 교육</title>
    <style>
        /* 특수교육 접근성을 고려한 기본 스타일 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            font-size: 18px;
            line-height: 1.6;
            color: #1e293b;
            overflow-x: hidden;
        }

        /* 메인 컨테이너 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            min-height: 100vh;
        }

        /* AI 튜터 영역 */
        .ai-tutor {
            position: fixed;
            right: 20px;
            top: 20px;
            width: 280px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: 3px solid #3b82f6;
            z-index: 1000;
            overflow: hidden;
        }

        .tutor-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 15px;
            text-align: center;
            position: relative;
        }

        .tutor-avatar {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            border: 3px solid #60a5fa;
        }

        .tutor-name {
            font-size: 20px;
            font-weight: bold;
        }

        .tutor-status {
            font-size: 14px;
            opacity: 0.9;
        }

        .tutor-body {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .tutor-message {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3b82f6;
            position: relative;
        }

        .tutor-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .tutor-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: #3b82f6;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tutor-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        /* 메인 학습 영역 */
        .main-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0;
        }

        /* 상단 네비게이션 */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 15px;
            color: white;
        }

        .nav-title {
            font-size: 24px;
            font-weight: bold;
        }

        .progress-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: conic-gradient(white 65%, rgba(255,255,255,0.3) 65%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6366f1;
            font-weight: bold;
            font-size: 16px;
        }

        /* 학습 영역 탭 */
        .learning-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f1f5f9;
            color: #64748b;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        /* 학습 콘텐츠 영역 */
        .learning-content {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #e2e8f0;
            min-height: 400px;
        }

        /* 읽기 영역 스타일 */
        .reading-area {
            text-align: center;
        }

        .word-display {
            font-size: 48px;
            font-weight: bold;
            color: #1e293b;
            background: white;
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #3b82f6;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .word-pronunciation {
            font-size: 20px;
            color: #64748b;
            margin-top: 15px;
        }

        .audio-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .audio-btn:hover {
            background: #059669;
            transform: scale(1.1);
        }

        /* 반복 학습 버튼들 */
        .repeat-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .repeat-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .repeat-btn.primary {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .repeat-btn.secondary {
            background: white;
            color: #6b7280;
            border: 2px solid #d1d5db;
        }

        .repeat-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* 쓰기 영역 */
        .writing-area {
            display: none;
        }

        .writing-canvas {
            width: 100%;
            height: 300px;
            border: 3px solid #3b82f6;
            border-radius: 15px;
            background: white;
            margin-bottom: 20px;
        }

        .writing-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* 듣기 영역 */
        .listening-area {
            display: none;
            text-align: center;
        }

        .sound-wave {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .wave-animation {
            position: absolute;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                rgba(255,255,255,0.1) 0px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.2) 10px,
                rgba(255,255,255,0.2) 20px
            );
            animation: waveMove 2s linear infinite;
        }

        @keyframes waveMove {
            0% { transform: translateX(-20px); }
            100% { transform: translateX(20px); }
        }

        .listen-btn {
            position: relative;
            z-index: 10;
            background: white;
            color: #8b5cf6;
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .listen-btn:hover {
            transform: scale(1.1);
        }

        /* 말하기 영역 */
        .speaking-area {
            display: none;
            text-align: center;
        }

        .mic-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mic-container:hover {
            transform: scale(1.05);
        }

        .mic-icon {
            font-size: 80px;
            color: white;
        }

        .recording-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            background: #22c55e;
            border-radius: 50%;
            border: 3px solid white;
            display: none;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* 하단 액션 버튼들 */
        .action-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .action-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.correct {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .action-btn.retry {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .action-btn.next {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        /* 접근성 향상을 위한 focus 스타일 */
        button:focus, .tab-btn:focus {
            outline: 3px solid #fbbf24;
            outline-offset: 2px;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 10px;
            }

            .ai-tutor {
                position: relative;
                right: auto;
                top: auto;
                width: 100%;
                margin-bottom: 20px;
            }

            .word-display {
                font-size: 36px;
                padding: 30px 20px;
            }

            .learning-tabs {
                flex-direction: column;
                gap: 10px;
            }

            .repeat-controls, .action-buttons {
                flex-direction: column;
            }
        }

        /* 고대비 모드 지원 */
        @media (prefers-contrast: high) {
            .word-display {
                border-width: 4px;
            }
            
            .tab-btn.active {
                border: 3px solid #000;
            }
        }

        /* 애니메이션 줄이기 선호도 고려 */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- AI 튜터 영역 -->
        <div class="ai-tutor">
            <div class="tutor-header">
                <div class="tutor-avatar">🤖</div>
                <div class="tutor-name">AI 한글이</div>
                <div class="tutor-status">항상 함께해요!</div>
            </div>
            <div class="tutor-body">
                <div class="tutor-message" id="tutorMessage">
                    안녕하세요! 오늘도 즐겁게 한글을 배워봐요. 
                    먼저 읽기부터 시작해볼까요? 
                    단어를 보고 따라 읽어보세요! 🎯
                </div>
                <div class="tutor-controls">
                    <button class="tutor-btn" onclick="getTutorHelp()">도움말</button>
                    <button class="tutor-btn" onclick="repeatInstruction()">다시듣기</button>
                </div>
            </div>
        </div>

        <!-- 메인 학습 영역 -->
        <div class="main-content">
            <!-- 상단 네비게이션 -->
            <div class="top-nav">
                <div class="nav-title">한글이와 함께 배우기</div>
                <div class="progress-circle">65%</div>
            </div>

            <!-- 학습 영역 탭 -->
            <div class="learning-tabs">
                <button class="tab-btn active" onclick="switchTab('reading')">📖 읽기</button>
                <button class="tab-btn" onclick="switchTab('writing')">✏️ 쓰기</button>
                <button class="tab-btn" onclick="switchTab('listening')">👂 듣기</button>
                <button class="tab-btn" onclick="switchTab('speaking')">🗣️ 말하기</button>
            </div>

            <!-- 학습 콘텐츠 영역 -->
            <div class="learning-content">
                <!-- 읽기 영역 -->
                <div class="reading-area" id="readingArea">
                    <div class="word-display">
                        <button class="audio-btn" onclick="playAudio()">🔊</button>
                        <div id="currentWord">사과</div>
                        <div class="word-pronunciation">[사과]</div>
                    </div>
                    
                    <div class="repeat-controls">
                        <button class="repeat-btn primary" onclick="repeatWord()">📢 다시 듣기</button>
                        <button class="repeat-btn secondary" onclick="showHint()">💡 힌트</button>
                        <button class="repeat-btn primary" onclick="recordReading()">🎤 따라 읽기</button>
                    </div>
                </div>

                <!-- 쓰기 영역 -->
                <div class="writing-area" id="writingArea">
                    <canvas class="writing-canvas" id="writingCanvas"></canvas>
                    <div class="writing-controls">
                        <button class="repeat-btn primary" onclick="clearCanvas()">🗑️ 지우기</button>
                        <button class="repeat-btn secondary" onclick="showWritingGuide()">📝 쓰기 가이드</button>
                        <button class="repeat-btn primary" onclick="checkWriting()">✓ 확인하기</button>
                    </div>
                </div>

                <!-- 듣기 영역 -->
                <div class="listening-area" id="listeningArea">
                    <div class="sound-wave">
                        <div class="wave-animation"></div>
                        <button class="listen-btn" onclick="playListeningContent()">▶️</button>
                    </div>
                    <p style="font-size: 20px; margin-bottom: 20px;">들려주는 단어를 골라보세요</p>
                    <div class="repeat-controls">
                        <button class="repeat-btn secondary" onclick="selectWord('사과')">🍎 사과</button>
                        <button class="repeat-btn secondary" onclick="selectWord('바나나')">🍌 바나나</button>
                        <button class="repeat-btn secondary" onclick="selectWord('포도')">🍇 포도</button>
                    </div>
                </div>

                <!-- 말하기 영역 -->
                <div class="speaking-area" id="speakingArea">
                    <div class="mic-container" onclick="toggleRecording()">
                        <div class="mic-icon">🎤</div>
                        <div class="recording-indicator"></div>
                    </div>
                    <p style="font-size: 20px; margin-bottom: 20px;">"사과"라고 말해보세요</p>
                    <div class="repeat-controls">
                        <button class="repeat-btn primary" onclick="playTargetWord()">🔊 목표 단어 듣기</button>
                        <button class="repeat-btn secondary" onclick="analyzePronunciation()">📊 발음 분석</button>
                    </div>
                </div>
            </div>

            <!-- 하단 액션 버튼들 -->
            <div class="action-buttons">
                <button class="action-btn correct" onclick="markCorrect()">✅ 잘했어요!</button>
                <button class="action-btn retry" onclick="retryActivity()">🔄 다시하기</button>
                <button class="action-btn next" onclick="nextActivity()">➡️ 다음 학습</button>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let currentTab = 'reading';
        let currentWord = '사과';
        let repeatCount = 0;
        let isRecording = false;
        let learningProgress = {
            reading: 0,
            writing: 0,
            listening: 0,
            speaking: 0
        };

        // 단어 목록 (반복학습용)
        const wordList = ['사과', '바나나', '포도', '딸기', '수박', '오렌지'];
        let currentWordIndex = 0;

        // 탭 전환 함수
        function switchTab(tab) {
            // 모든 탭 비활성화
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // 모든 영역 숨기기
            document.querySelectorAll('.reading-area, .writing-area, .listening-area, .speaking-area').forEach(area => {
                area.style.display = 'none';
            });

            // 선택된 탭 활성화
            event.target.classList.add('active');
            document.getElementById(tab + 'Area').style.display = 'block';
            
            currentTab = tab;
            updateTutorMessage(tab);
        }

        // AI 튜터 메시지 업데이트
        function updateTutorMessage(tab) {
            const messages = {
                reading: `좋아요! 이제 "${currentWord}"를 큰 소리로 읽어보세요. 🗣️ 틀려도 괜찮으니 자신감 있게 해보세요!`,
                writing: `이번에는 "${currentWord}"를 직접 써보는 시간이에요! ✏️ 천천히 따라 써보세요. 반복 연습이 중요해요!`,
                listening: `귀 기울여 들어보세요! 👂 어떤 단어인지 맞춰보세요. 몇 번 들어도 괜찮아요!`,
                speaking: `마이크 버튼을 눌러서 "${currentWord}"라고 말해보세요! 🎤 발음이 조금 달라도 괜찮으니 용기내세요!`
            };
            
            document.getElementById('tutorMessage').innerHTML = messages[tab];
        }

        // 음성 재생 (실제로는 Web Speech API 사용)
        function playAudio() {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(currentWord);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8; // 특수 아동을 위해 느리게
                speechSynthesis.speak(utterance);
            }
            
            repeatCount++;
            updateTutorMessage('reading');
        }

        // 단어 반복 재생
        function repeatWord() {
            playAudio();
            
            // 반복 학습 피드백
            if (repeatCount >= 3) {
                document.getElementById('tutorMessage').innerHTML = 
                    `훌륭해요! 벌써 ${repeatCount}번이나 들었네요! 🎉 이제 따라 읽어볼까요?`;
            }
        }

        // 힌트 표시
        function showHint() {
            document.getElementById('tutorMessage').innerHTML = 
                `💡 힌트: "${currentWord}"는 빨간색이고 동그란 과일이에요! 맛있는 과일 중 하나랍니다! 🍎`;
        }

        // 따라 읽기 녹음
        function recordReading() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        // 녹음 시작
        function startRecording() {
            isRecording = true;
            document.querySelector('.recording-indicator').style.display = 'block';
            document.getElementById('tutorMessage').innerHTML = 
                `🎤 녹음 중이에요! "${currentWord}"라고 또렷하게 말해보세요!`;
            
            // 실제로는 Web Speech API나 MediaRecorder API 사용
            setTimeout(() => {
                stopRecording();
            }, 3000);
        }

        // 녹음 중지
        function stopRecording() {
            isRecording = false;
            document.querySelector('.recording-indicator').style.display = 'none';
            
            // 간단한 피드백 (실제로는 음성 인식 결과 기반)
            const feedbacks = [
                "정말 잘했어요! 발음이 완벽해요! 🌟",
                "좋아요! 조금 더 크게 말하면 더 좋을 것 같아요! 📢",
                "훌륭해요! 다음 단어도 도전해봐요! 🚀"
            ];
            
            document.getElementById('tutorMessage').innerHTML = 
                feedbacks[Math.floor(Math.random() * feedbacks.length)];
        }

        // 캔버스 지우기
        function clearCanvas() {
            const canvas = document.getElementById('writingCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // 쓰기 가이드 표시
        function showWritingGuide() {
            document.getElementById('tutorMessage').innerHTML = 
                `✏️ 쓰기 도움말: "${currentWord}"는 'ㅅ', 'ㅏ', 'ㄱ', 'ㅗ'를 차례로 써주세요! 천천히 따라 써보세요! 💪`;
        }

        // 쓰기 확인
        function checkWriting() {
            document.getElementById('tutorMessage').innerHTML = 
                `와! 정말 열심히 썼네요! 🎉 글씨가 점점 좋아지고 있어요! 다음에도 이렇게 열심히 해봐요! ⭐`;
        }

        // 듣기 콘텐츠 재생
        function playListeningContent() {
            playAudio();
            document.getElementById('tutorMessage').innerHTML = 
                `🎵 잘 들었나요? 들은 단어를 아래에서 선택해보세요! 틀려도 괜찮으니 한번 골라보세요! 🤔`;
        }

        // 단어 선택
        function selectWord(word) {
            if (word === currentWord) {
                document.getElementById('tutorMessage').innerHTML = 
                    `🎉 정답이에요! "${word}"를 정확히 찾았네요! 귀가 정말 좋아요! 👏`;
                setTimeout(() => nextActivity(), 2000);
            } else {
                document.getElementById('tutorMessage').innerHTML = 
                    `조금 다른 것 같아요! 다시 들어보고 골라보세요! 힌트: 빨간색 과일이에요! 🍎`;
            }
        }

        // 말하기 영역 녹음 토글
        function toggleRecording() {
            const indicator = document.querySelector('.speaking-area .recording-indicator');
            if (!isRecording) {
                isRecording = true;
                indicator.style.display = 'block';
                document.getElementById('tutorMessage').innerHTML = 
                    `🎤 녹음이 시작되었어요! "${currentWord}"라고 천천히 말해보세요!`;
                
                setTimeout(() => {
                    isRecording = false;
                    indicator.style.display = 'none';
                    analyzePronunciation();
                }, 3000);
            }
        }

        // 목표 단어 재생
        function playTargetWord() {
            playAudio();
        }

        // 발음 분석
        function analyzePronunciation() {
            const scores = [85, 92, 78, 94, 88];
            const score = scores[Math.floor(Math.random() * scores.length)];
            
            if (score >= 90) {
                document.getElementById('tutorMessage').innerHTML = 
                    `🌟 완벽해요! 발음 점수: ${score}점! 정말 또렷하게 잘 말했어요! 최고예요! 🏆`;
            } else if (score >= 80) {
                document.getElementById('tutorMessage').innerHTML = 
                    `👍 좋아요! 발음 점수: ${score}점! 조금만 더 연습하면 완벽할 거예요! 화이팅! 💪`;
            } else {
                document.getElementById('tutorMessage').innerHTML = 
                    `😊 발음 점수: ${score}점! 괜찮아요! 다시 한번 도전해볼까요? 연습할수록 늘어요! 🌱`;
            }
        }

        // 정답 처리
        function markCorrect() {
            learningProgress[currentTab] += 10;
            document.getElementById('tutorMessage').innerHTML = 
                `🎉 정말 잘했어요! ${currentTab} 영역에서 10점을 얻었어요! 계속 이렇게 열심히 해봐요! ⭐`;
            
            // 진행률 업데이트
            updateProgress();
            
            // 성취감을 위한 효과음 (실제로는 Web Audio API 사용)
            playSuccessSound();
        }

        // 다시하기
        function retryActivity() {
            repeatCount = 0;
            document.getElementById('tutorMessage').innerHTML = 
                `👍 다시 도전하는 모습이 멋져요! 천천히 해보세요. 실수해도 괜찮아요! 💪`;
            
            // 현재 활동 초기화
            if (currentTab === 'writing') {
                clearCanvas();
            }
        }

        // 다음 활동
        function nextActivity() {
            currentWordIndex = (currentWordIndex + 1) % wordList.length;
            currentWord = wordList[currentWordIndex];
            
            // 단어 표시 업데이트
            document.getElementById('currentWord').textContent = currentWord;
            
            // 반복 카운트 초기화
            repeatCount = 0;
            
            // 새로운 단어에 대한 안내
            document.getElementById('tutorMessage').innerHTML = 
                `🎯 새로운 단어예요! 이번에는 "${currentWord}"를 배워봐요! 새로운 도전을 시작해봐요! 🚀`;
            
            // 진행률 업데이트
            updateProgress();
            
            // 자동으로 단어 발음
            setTimeout(() => {
                playAudio();
            }, 1000);
        }

        // 진행률 업데이트
        function updateProgress() {
            const totalProgress = Object.values(learningProgress).reduce((a, b) => a + b, 0) / 4;
            const progressElement = document.querySelector('.progress-circle');
            progressElement.textContent = Math.min(100, Math.round(totalProgress)) + '%';
            
            // 진행률에 따른 색상 변경
            if (totalProgress >= 80) {
                progressElement.style.background = 'conic-gradient(#22c55e ' + totalProgress + '%, rgba(255,255,255,0.3) ' + totalProgress + '%)';
            } else if (totalProgress >= 50) {
                progressElement.style.background = 'conic-gradient(#f59e0b ' + totalProgress + '%, rgba(255,255,255,0.3) ' + totalProgress + '%)';
            }
        }

        // 성공 효과음 재생
        function playSuccessSound() {
            // 실제로는 Web Audio API를 사용하여 효과음 재생
            console.log('성공 효과음 재생');
        }

        // AI 튜터 도움말
        function getTutorHelp() {
            const helpMessages = {
                reading: `📖 읽기 도움말:\n1. 🔊 버튼을 눌러서 단어를 들어보세요\n2. 여러 번 들어도 괜찮아요\n3. 따라 읽기를 해보세요\n4. 틀려도 괜찮으니 자신감 있게 하세요!`,
                writing: `✏️ 쓰기 도움말:\n1. 화면에 손가락으로 글자를 써보세요\n2. 천천히 따라 써도 괜찮아요\n3. 잘못 썼으면 지우기 버튼을 누르세요\n4. 반복 연습이 중요해요!`,
                listening: `👂 듣기 도움말:\n1. ▶️ 버튼을 눌러서 단어를 들어보세요\n2. 여러 번 들을 수 있어요\n3. 들은 단어를 아래에서 선택하세요\n4. 집중해서 들어보세요!`,
                speaking: `🗣️ 말하기 도움말:\n1. 마이크 버튼을 눌러주세요\n2. 크고 또렷하게 말해보세요\n3. 발음이 조금 다르더라도 괜찮아요\n4. 자신감 있게 말하는 게 중요해요!`
            };
            
            document.getElementById('tutorMessage').innerHTML = helpMessages[currentTab];
        }

        // 지시사항 다시 듣기
        function repeatInstruction() {
            updateTutorMessage(currentTab);
            
            // 음성으로 지시사항 읽어주기 (실제로는 TTS 사용)
            if ('speechSynthesis' in window) {
                const message = document.getElementById('tutorMessage').textContent;
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.7; // 더 천천히
                speechSynthesis.speak(utterance);
            }
        }

        // 캔버스 그리기 기능 초기화
        function initCanvas() {
            const canvas = document.getElementById('writingCanvas');
            const ctx = canvas.getContext('2d');
            
            // 캔버스 크기 설정
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            // 그리기 설정
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // 마우스 이벤트
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // 터치 이벤트 (모바일 지원)
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getMousePos(e);
            }

            function draw(e) {
                if (!isDrawing) return;
                
                const [currentX, currentY] = getMousePos(e);
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                
                [lastX, lastY] = [currentX, currentY];
            }

            function stopDrawing() {
                isDrawing = false;
            }

            function getMousePos(e) {
                const rect = canvas.getBoundingClientRect();
                return [
                    e.clientX - rect.left,
                    e.clientY - rect.top
                ];
            }

            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                  e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }

        // 키보드 접근성 지원
        function initKeyboardSupport() {
            document.addEventListener('keydown', (e) => {
                // 스페이스바로 오디오 재생
                if (e.code === 'Space' && currentTab === 'reading') {
                    e.preventDefault();
                    playAudio();
                }
                
                // 숫자 키로 탭 전환
                if (e.code >= 'Digit1' && e.code <= 'Digit4') {
                    const tabs = ['reading', 'writing', 'listening', 'speaking'];
                    const tabIndex = parseInt(e.code.slice(-1)) - 1;
                    if (tabs[tabIndex]) {
                        switchTab(tabs[tabIndex]);
                    }
                }
                
                // Enter로 다음 활동
                if (e.code === 'Enter') {
                    nextActivity();
                }
                
                // ESC로 다시하기
                if (e.code === 'Escape') {
                    retryActivity();
                }
            });
        }

        // 반복 학습 알고리즘 (간격 반복)
        class SpacedRepetition {
            constructor() {
                this.intervals = [1, 3, 7, 14, 30]; // 분 단위
                this.wordData = {};
            }

            // 단어 학습 기록
            recordLearning(word, correct) {
                if (!this.wordData[word]) {
                    this.wordData[word] = {
                        level: 0,
                        lastReview: new Date(),
                        correctCount: 0,
                        totalCount: 0
                    };
                }

                const data = this.wordData[word];
                data.totalCount++;
                
                if (correct) {
                    data.correctCount++;
                    data.level = Math.min(data.level + 1, this.intervals.length - 1);
                } else {
                    data.level = Math.max(0, data.level - 1);
                }
                
                data.lastReview = new Date();
                
                // 로컬 스토리지에 저장 (실제로는 서버 DB)
                localStorage.setItem('wordData', JSON.stringify(this.wordData));
            }

            // 다음 복습 시간 계산
            getNextReviewTime(word) {
                const data = this.wordData[word];
                if (!data) return new Date();
                
                const interval = this.intervals[data.level] * 60 * 1000; // 밀리초 변환
                return new Date(data.lastReview.getTime() + interval);
            }

            // 복습이 필요한 단어 목록
            getWordsForReview() {
                const now = new Date();
                return Object.keys(this.wordData).filter(word => {
                    return this.getNextReviewTime(word) <= now;
                });
            }
        }

        // 전역 반복 학습 시스템 초기화
        const spacedRepetition = new SpacedRepetition();

        // 접근성 설정
        function initAccessibility() {
            // 고대비 모드 감지
            if (window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches) {
                document.body.classList.add('high-contrast');
            }

            // 애니메이션 감소 모드 감지
            if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.body.classList.add('reduced-motion');
            }

            // 폰트 크기 조절 기능
            const fontSizeSlider = document.createElement('input');
            fontSizeSlider.type = 'range';
            fontSizeSlider.min = '14';
            fontSizeSlider.max = '24';
            fontSizeSlider.value = '18';
            fontSizeSlider.style.position = 'fixed';
            fontSizeSlider.style.bottom = '20px';
            fontSizeSlider.style.left = '20px';
            fontSizeSlider.style.zIndex = '1001';
            
            fontSizeSlider.addEventListener('input', (e) => {
                document.body.style.fontSize = e.target.value + 'px';
            });
            
            document.body.appendChild(fontSizeSlider);
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            initCanvas();
            initKeyboardSupport();
            initAccessibility();
            
            // 첫 단어 발음
            setTimeout(() => {
                playAudio();
            }, 1000);
            
            // 로컬 스토리지에서 학습 데이터 복원
            const savedData = localStorage.getItem('wordData');
            if (savedData) {
                spacedRepetition.wordData = JSON.parse(savedData);
            }
        });

        // 학습 세션 종료 시 데이터 저장
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('learningProgress', JSON.stringify(learningProgress));
        });
    </script>
</body>
</html>