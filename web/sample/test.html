<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œê¸€ì´ì™€ í•¨ê»˜ - íŠ¹ìˆ˜ ì•„ë™ í•œêµ­ì–´ êµìœ¡</title>
    <style>
        /* íŠ¹ìˆ˜êµìœ¡ ì ‘ê·¼ì„±ì„ ê³ ë ¤í•œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            font-size: 18px;
            line-height: 1.6;
            color: #1e293b;
            overflow-x: hidden;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 30px;
            min-height: 100vh;
        }

        /* AI íŠœí„° ì˜ì—­ */
        .ai-tutor {
            position: fixed;
            right: 20px;
            top: 20px;
            width: 280px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border: 3px solid #3b82f6;
            z-index: 1000;
            overflow: hidden;
        }

        .tutor-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 15px;
            text-align: center;
            position: relative;
        }

        .tutor-avatar {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            border: 3px solid #60a5fa;
        }

        .tutor-name {
            font-size: 20px;
            font-weight: bold;
        }

        .tutor-status {
            font-size: 14px;
            opacity: 0.9;
        }

        .tutor-body {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .tutor-message {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #3b82f6;
            position: relative;
        }

        .tutor-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .tutor-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: #3b82f6;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tutor-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        /* ë©”ì¸ í•™ìŠµ ì˜ì—­ */
        .main-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0;
        }

        /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 15px;
            color: white;
        }

        .nav-title {
            font-size: 24px;
            font-weight: bold;
        }

        .progress-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: conic-gradient(white 65%, rgba(255,255,255,0.3) 65%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6366f1;
            font-weight: bold;
            font-size: 16px;
        }

        /* í•™ìŠµ ì˜ì—­ íƒ­ */
        .learning-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f1f5f9;
            color: #64748b;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        /* í•™ìŠµ ì½˜í…ì¸  ì˜ì—­ */
        .learning-content {
            background: #f8fafc;
            border-radius: 15px;
            padding: 30px;
            border: 2px solid #e2e8f0;
            min-height: 400px;
        }

        /* ì½ê¸° ì˜ì—­ ìŠ¤íƒ€ì¼ */
        .reading-area {
            text-align: center;
        }

        .word-display {
            font-size: 48px;
            font-weight: bold;
            color: #1e293b;
            background: white;
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #3b82f6;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .word-pronunciation {
            font-size: 20px;
            color: #64748b;
            margin-top: 15px;
        }

        .audio-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .audio-btn:hover {
            background: #059669;
            transform: scale(1.1);
        }

        /* ë°˜ë³µ í•™ìŠµ ë²„íŠ¼ë“¤ */
        .repeat-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }

        .repeat-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .repeat-btn.primary {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .repeat-btn.secondary {
            background: white;
            color: #6b7280;
            border: 2px solid #d1d5db;
        }

        .repeat-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        /* ì“°ê¸° ì˜ì—­ */
        .writing-area {
            display: none;
        }

        .writing-canvas {
            width: 100%;
            height: 300px;
            border: 3px solid #3b82f6;
            border-radius: 15px;
            background: white;
            margin-bottom: 20px;
        }

        .writing-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* ë“£ê¸° ì˜ì—­ */
        .listening-area {
            display: none;
            text-align: center;
        }

        .sound-wave {
            width: 100%;
            height: 150px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .wave-animation {
            position: absolute;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                rgba(255,255,255,0.1) 0px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.2) 10px,
                rgba(255,255,255,0.2) 20px
            );
            animation: waveMove 2s linear infinite;
        }

        @keyframes waveMove {
            0% { transform: translateX(-20px); }
            100% { transform: translateX(20px); }
        }

        .listen-btn {
            position: relative;
            z-index: 10;
            background: white;
            color: #8b5cf6;
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            font-size: 36px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .listen-btn:hover {
            transform: scale(1.1);
        }

        /* ë§í•˜ê¸° ì˜ì—­ */
        .speaking-area {
            display: none;
            text-align: center;
        }

        .mic-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mic-container:hover {
            transform: scale(1.05);
        }

        .mic-icon {
            font-size: 80px;
            color: white;
        }

        .recording-indicator {
            position: absolute;
            top: -10px;
            right: -10px;
            width: 30px;
            height: 30px;
            background: #22c55e;
            border-radius: 50%;
            border: 3px solid white;
            display: none;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        /* í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ë“¤ */
        .action-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }

        .action-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.correct {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .action-btn.retry {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .action-btn.next {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        /* ì ‘ê·¼ì„± í–¥ìƒì„ ìœ„í•œ focus ìŠ¤íƒ€ì¼ */
        button:focus, .tab-btn:focus {
            outline: 3px solid #fbbf24;
            outline-offset: 2px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 10px;
            }

            .ai-tutor {
                position: relative;
                right: auto;
                top: auto;
                width: 100%;
                margin-bottom: 20px;
            }

            .word-display {
                font-size: 36px;
                padding: 30px 20px;
            }

            .learning-tabs {
                flex-direction: column;
                gap: 10px;
            }

            .repeat-controls, .action-buttons {
                flex-direction: column;
            }
        }

        /* ê³ ëŒ€ë¹„ ëª¨ë“œ ì§€ì› */
        @media (prefers-contrast: high) {
            .word-display {
                border-width: 4px;
            }
            
            .tab-btn.active {
                border: 3px solid #000;
            }
        }

        /* ì• ë‹ˆë©”ì´ì…˜ ì¤„ì´ê¸° ì„ í˜¸ë„ ê³ ë ¤ */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- AI íŠœí„° ì˜ì—­ -->
        <div class="ai-tutor">
            <div class="tutor-header">
                <div class="tutor-avatar">ğŸ¤–</div>
                <div class="tutor-name">AI í•œê¸€ì´</div>
                <div class="tutor-status">í•­ìƒ í•¨ê»˜í•´ìš”!</div>
            </div>
            <div class="tutor-body">
                <div class="tutor-message" id="tutorMessage">
                    ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ë„ ì¦ê²ê²Œ í•œê¸€ì„ ë°°ì›Œë´ìš”. 
                    ë¨¼ì € ì½ê¸°ë¶€í„° ì‹œì‘í•´ë³¼ê¹Œìš”? 
                    ë‹¨ì–´ë¥¼ ë³´ê³  ë”°ë¼ ì½ì–´ë³´ì„¸ìš”! ğŸ¯
                </div>
                <div class="tutor-controls">
                    <button class="tutor-btn" onclick="getTutorHelp()">ë„ì›€ë§</button>
                    <button class="tutor-btn" onclick="repeatInstruction()">ë‹¤ì‹œë“£ê¸°</button>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ í•™ìŠµ ì˜ì—­ -->
        <div class="main-content">
            <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
            <div class="top-nav">
                <div class="nav-title">í•œê¸€ì´ì™€ í•¨ê»˜ ë°°ìš°ê¸°</div>
                <div class="progress-circle">65%</div>
            </div>

            <!-- í•™ìŠµ ì˜ì—­ íƒ­ -->
            <div class="learning-tabs">
                <button class="tab-btn active" onclick="switchTab('reading')">ğŸ“– ì½ê¸°</button>
                <button class="tab-btn" onclick="switchTab('writing')">âœï¸ ì“°ê¸°</button>
                <button class="tab-btn" onclick="switchTab('listening')">ğŸ‘‚ ë“£ê¸°</button>
                <button class="tab-btn" onclick="switchTab('speaking')">ğŸ—£ï¸ ë§í•˜ê¸°</button>
            </div>

            <!-- í•™ìŠµ ì½˜í…ì¸  ì˜ì—­ -->
            <div class="learning-content">
                <!-- ì½ê¸° ì˜ì—­ -->
                <div class="reading-area" id="readingArea">
                    <div class="word-display">
                        <button class="audio-btn" onclick="playAudio()">ğŸ”Š</button>
                        <div id="currentWord">ì‚¬ê³¼</div>
                        <div class="word-pronunciation">[ì‚¬ê³¼]</div>
                    </div>
                    
                    <div class="repeat-controls">
                        <button class="repeat-btn primary" onclick="repeatWord()">ğŸ“¢ ë‹¤ì‹œ ë“£ê¸°</button>
                        <button class="repeat-btn secondary" onclick="showHint()">ğŸ’¡ íŒíŠ¸</button>
                        <button class="repeat-btn primary" onclick="recordReading()">ğŸ¤ ë”°ë¼ ì½ê¸°</button>
                    </div>
                </div>

                <!-- ì“°ê¸° ì˜ì—­ -->
                <div class="writing-area" id="writingArea">
                    <canvas class="writing-canvas" id="writingCanvas"></canvas>
                    <div class="writing-controls">
                        <button class="repeat-btn primary" onclick="clearCanvas()">ğŸ—‘ï¸ ì§€ìš°ê¸°</button>
                        <button class="repeat-btn secondary" onclick="showWritingGuide()">ğŸ“ ì“°ê¸° ê°€ì´ë“œ</button>
                        <button class="repeat-btn primary" onclick="checkWriting()">âœ“ í™•ì¸í•˜ê¸°</button>
                    </div>
                </div>

                <!-- ë“£ê¸° ì˜ì—­ -->
                <div class="listening-area" id="listeningArea">
                    <div class="sound-wave">
                        <div class="wave-animation"></div>
                        <button class="listen-btn" onclick="playListeningContent()">â–¶ï¸</button>
                    </div>
                    <p style="font-size: 20px; margin-bottom: 20px;">ë“¤ë ¤ì£¼ëŠ” ë‹¨ì–´ë¥¼ ê³¨ë¼ë³´ì„¸ìš”</p>
                    <div class="repeat-controls">
                        <button class="repeat-btn secondary" onclick="selectWord('ì‚¬ê³¼')">ğŸ ì‚¬ê³¼</button>
                        <button class="repeat-btn secondary" onclick="selectWord('ë°”ë‚˜ë‚˜')">ğŸŒ ë°”ë‚˜ë‚˜</button>
                        <button class="repeat-btn secondary" onclick="selectWord('í¬ë„')">ğŸ‡ í¬ë„</button>
                    </div>
                </div>

                <!-- ë§í•˜ê¸° ì˜ì—­ -->
                <div class="speaking-area" id="speakingArea">
                    <div class="mic-container" onclick="toggleRecording()">
                        <div class="mic-icon">ğŸ¤</div>
                        <div class="recording-indicator"></div>
                    </div>
                    <p style="font-size: 20px; margin-bottom: 20px;">"ì‚¬ê³¼"ë¼ê³  ë§í•´ë³´ì„¸ìš”</p>
                    <div class="repeat-controls">
                        <button class="repeat-btn primary" onclick="playTargetWord()">ğŸ”Š ëª©í‘œ ë‹¨ì–´ ë“£ê¸°</button>
                        <button class="repeat-btn secondary" onclick="analyzePronunciation()">ğŸ“Š ë°œìŒ ë¶„ì„</button>
                    </div>
                </div>
            </div>

            <!-- í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
            <div class="action-buttons">
                <button class="action-btn correct" onclick="markCorrect()">âœ… ì˜í–ˆì–´ìš”!</button>
                <button class="action-btn retry" onclick="retryActivity()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
                <button class="action-btn next" onclick="nextActivity()">â¡ï¸ ë‹¤ìŒ í•™ìŠµ</button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentTab = 'reading';
        let currentWord = 'ì‚¬ê³¼';
        let repeatCount = 0;
        let isRecording = false;
        let learningProgress = {
            reading: 0,
            writing: 0,
            listening: 0,
            speaking: 0
        };

        // ë‹¨ì–´ ëª©ë¡ (ë°˜ë³µí•™ìŠµìš©)
        const wordList = ['ì‚¬ê³¼', 'ë°”ë‚˜ë‚˜', 'í¬ë„', 'ë”¸ê¸°', 'ìˆ˜ë°•', 'ì˜¤ë Œì§€'];
        let currentWordIndex = 0;

        // íƒ­ ì „í™˜ í•¨ìˆ˜
        function switchTab(tab) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ëª¨ë“  ì˜ì—­ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.reading-area, .writing-area, .listening-area, .speaking-area').forEach(area => {
                area.style.display = 'none';
            });

            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tab + 'Area').style.display = 'block';
            
            currentTab = tab;
            updateTutorMessage(tab);
        }

        // AI íŠœí„° ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateTutorMessage(tab) {
            const messages = {
                reading: `ì¢‹ì•„ìš”! ì´ì œ "${currentWord}"ë¥¼ í° ì†Œë¦¬ë¡œ ì½ì–´ë³´ì„¸ìš”. ğŸ—£ï¸ í‹€ë ¤ë„ ê´œì°®ìœ¼ë‹ˆ ìì‹ ê° ìˆê²Œ í•´ë³´ì„¸ìš”!`,
                writing: `ì´ë²ˆì—ëŠ” "${currentWord}"ë¥¼ ì§ì ‘ ì¨ë³´ëŠ” ì‹œê°„ì´ì—ìš”! âœï¸ ì²œì²œíˆ ë”°ë¼ ì¨ë³´ì„¸ìš”. ë°˜ë³µ ì—°ìŠµì´ ì¤‘ìš”í•´ìš”!`,
                listening: `ê·€ ê¸°ìš¸ì—¬ ë“¤ì–´ë³´ì„¸ìš”! ğŸ‘‚ ì–´ë–¤ ë‹¨ì–´ì¸ì§€ ë§ì¶°ë³´ì„¸ìš”. ëª‡ ë²ˆ ë“¤ì–´ë„ ê´œì°®ì•„ìš”!`,
                speaking: `ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ "${currentWord}"ë¼ê³  ë§í•´ë³´ì„¸ìš”! ğŸ¤ ë°œìŒì´ ì¡°ê¸ˆ ë‹¬ë¼ë„ ê´œì°®ìœ¼ë‹ˆ ìš©ê¸°ë‚´ì„¸ìš”!`
            };
            
            document.getElementById('tutorMessage').innerHTML = messages[tab];
        }

        // ìŒì„± ì¬ìƒ (ì‹¤ì œë¡œëŠ” Web Speech API ì‚¬ìš©)
        function playAudio() {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(currentWord);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8; // íŠ¹ìˆ˜ ì•„ë™ì„ ìœ„í•´ ëŠë¦¬ê²Œ
                speechSynthesis.speak(utterance);
            }
            
            repeatCount++;
            updateTutorMessage('reading');
        }

        // ë‹¨ì–´ ë°˜ë³µ ì¬ìƒ
        function repeatWord() {
            playAudio();
            
            // ë°˜ë³µ í•™ìŠµ í”¼ë“œë°±
            if (repeatCount >= 3) {
                document.getElementById('tutorMessage').innerHTML = 
                    `í›Œë¥­í•´ìš”! ë²Œì¨ ${repeatCount}ë²ˆì´ë‚˜ ë“¤ì—ˆë„¤ìš”! ğŸ‰ ì´ì œ ë”°ë¼ ì½ì–´ë³¼ê¹Œìš”?`;
            }
        }

        // íŒíŠ¸ í‘œì‹œ
        function showHint() {
            document.getElementById('tutorMessage').innerHTML = 
                `ğŸ’¡ íŒíŠ¸: "${currentWord}"ëŠ” ë¹¨ê°„ìƒ‰ì´ê³  ë™ê·¸ë€ ê³¼ì¼ì´ì—ìš”! ë§›ìˆëŠ” ê³¼ì¼ ì¤‘ í•˜ë‚˜ëë‹ˆë‹¤! ğŸ`;
        }

        // ë”°ë¼ ì½ê¸° ë…¹ìŒ
        function recordReading() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }

        // ë…¹ìŒ ì‹œì‘
        function startRecording() {
            isRecording = true;
            document.querySelector('.recording-indicator').style.display = 'block';
            document.getElementById('tutorMessage').innerHTML = 
                `ğŸ¤ ë…¹ìŒ ì¤‘ì´ì—ìš”! "${currentWord}"ë¼ê³  ë˜ë ·í•˜ê²Œ ë§í•´ë³´ì„¸ìš”!`;
            
            // ì‹¤ì œë¡œëŠ” Web Speech APIë‚˜ MediaRecorder API ì‚¬ìš©
            setTimeout(() => {
                stopRecording();
            }, 3000);
        }

        // ë…¹ìŒ ì¤‘ì§€
        function stopRecording() {
            isRecording = false;
            document.querySelector('.recording-indicator').style.display = 'none';
            
            // ê°„ë‹¨í•œ í”¼ë“œë°± (ì‹¤ì œë¡œëŠ” ìŒì„± ì¸ì‹ ê²°ê³¼ ê¸°ë°˜)
            const feedbacks = [
                "ì •ë§ ì˜í–ˆì–´ìš”! ë°œìŒì´ ì™„ë²½í•´ìš”! ğŸŒŸ",
                "ì¢‹ì•„ìš”! ì¡°ê¸ˆ ë” í¬ê²Œ ë§í•˜ë©´ ë” ì¢‹ì„ ê²ƒ ê°™ì•„ìš”! ğŸ“¢",
                "í›Œë¥­í•´ìš”! ë‹¤ìŒ ë‹¨ì–´ë„ ë„ì „í•´ë´ìš”! ğŸš€"
            ];
            
            document.getElementById('tutorMessage').innerHTML = 
                feedbacks[Math.floor(Math.random() * feedbacks.length)];
        }

        // ìº”ë²„ìŠ¤ ì§€ìš°ê¸°
        function clearCanvas() {
            const canvas = document.getElementById('writingCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // ì“°ê¸° ê°€ì´ë“œ í‘œì‹œ
        function showWritingGuide() {
            document.getElementById('tutorMessage').innerHTML = 
                `âœï¸ ì“°ê¸° ë„ì›€ë§: "${currentWord}"ëŠ” 'ã……', 'ã…', 'ã„±', 'ã…—'ë¥¼ ì°¨ë¡€ë¡œ ì¨ì£¼ì„¸ìš”! ì²œì²œíˆ ë”°ë¼ ì¨ë³´ì„¸ìš”! ğŸ’ª`;
        }

        // ì“°ê¸° í™•ì¸
        function checkWriting() {
            document.getElementById('tutorMessage').innerHTML = 
                `ì™€! ì •ë§ ì—´ì‹¬íˆ ì¼ë„¤ìš”! ğŸ‰ ê¸€ì”¨ê°€ ì ì  ì¢‹ì•„ì§€ê³  ìˆì–´ìš”! ë‹¤ìŒì—ë„ ì´ë ‡ê²Œ ì—´ì‹¬íˆ í•´ë´ìš”! â­`;
        }

        // ë“£ê¸° ì½˜í…ì¸  ì¬ìƒ
        function playListeningContent() {
            playAudio();
            document.getElementById('tutorMessage').innerHTML = 
                `ğŸµ ì˜ ë“¤ì—ˆë‚˜ìš”? ë“¤ì€ ë‹¨ì–´ë¥¼ ì•„ë˜ì—ì„œ ì„ íƒí•´ë³´ì„¸ìš”! í‹€ë ¤ë„ ê´œì°®ìœ¼ë‹ˆ í•œë²ˆ ê³¨ë¼ë³´ì„¸ìš”! ğŸ¤”`;
        }

        // ë‹¨ì–´ ì„ íƒ
        function selectWord(word) {
            if (word === currentWord) {
                document.getElementById('tutorMessage').innerHTML = 
                    `ğŸ‰ ì •ë‹µì´ì—ìš”! "${word}"ë¥¼ ì •í™•íˆ ì°¾ì•˜ë„¤ìš”! ê·€ê°€ ì •ë§ ì¢‹ì•„ìš”! ğŸ‘`;
                setTimeout(() => nextActivity(), 2000);
            } else {
                document.getElementById('tutorMessage').innerHTML = 
                    `ì¡°ê¸ˆ ë‹¤ë¥¸ ê²ƒ ê°™ì•„ìš”! ë‹¤ì‹œ ë“¤ì–´ë³´ê³  ê³¨ë¼ë³´ì„¸ìš”! íŒíŠ¸: ë¹¨ê°„ìƒ‰ ê³¼ì¼ì´ì—ìš”! ğŸ`;
            }
        }

        // ë§í•˜ê¸° ì˜ì—­ ë…¹ìŒ í† ê¸€
        function toggleRecording() {
            const indicator = document.querySelector('.speaking-area .recording-indicator');
            if (!isRecording) {
                isRecording = true;
                indicator.style.display = 'block';
                document.getElementById('tutorMessage').innerHTML = 
                    `ğŸ¤ ë…¹ìŒì´ ì‹œì‘ë˜ì—ˆì–´ìš”! "${currentWord}"ë¼ê³  ì²œì²œíˆ ë§í•´ë³´ì„¸ìš”!`;
                
                setTimeout(() => {
                    isRecording = false;
                    indicator.style.display = 'none';
                    analyzePronunciation();
                }, 3000);
            }
        }

        // ëª©í‘œ ë‹¨ì–´ ì¬ìƒ
        function playTargetWord() {
            playAudio();
        }

        // ë°œìŒ ë¶„ì„
        function analyzePronunciation() {
            const scores = [85, 92, 78, 94, 88];
            const score = scores[Math.floor(Math.random() * scores.length)];
            
            if (score >= 90) {
                document.getElementById('tutorMessage').innerHTML = 
                    `ğŸŒŸ ì™„ë²½í•´ìš”! ë°œìŒ ì ìˆ˜: ${score}ì ! ì •ë§ ë˜ë ·í•˜ê²Œ ì˜ ë§í–ˆì–´ìš”! ìµœê³ ì˜ˆìš”! ğŸ†`;
            } else if (score >= 80) {
                document.getElementById('tutorMessage').innerHTML = 
                    `ğŸ‘ ì¢‹ì•„ìš”! ë°œìŒ ì ìˆ˜: ${score}ì ! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•˜ë©´ ì™„ë²½í•  ê±°ì˜ˆìš”! í™”ì´íŒ…! ğŸ’ª`;
            } else {
                document.getElementById('tutorMessage').innerHTML = 
                    `ğŸ˜Š ë°œìŒ ì ìˆ˜: ${score}ì ! ê´œì°®ì•„ìš”! ë‹¤ì‹œ í•œë²ˆ ë„ì „í•´ë³¼ê¹Œìš”? ì—°ìŠµí• ìˆ˜ë¡ ëŠ˜ì–´ìš”! ğŸŒ±`;
            }
        }

        // ì •ë‹µ ì²˜ë¦¬
        function markCorrect() {
            learningProgress[currentTab] += 10;
            document.getElementById('tutorMessage').innerHTML = 
                `ğŸ‰ ì •ë§ ì˜í–ˆì–´ìš”! ${currentTab} ì˜ì—­ì—ì„œ 10ì ì„ ì–»ì—ˆì–´ìš”! ê³„ì† ì´ë ‡ê²Œ ì—´ì‹¬íˆ í•´ë´ìš”! â­`;
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            updateProgress();
            
            // ì„±ì·¨ê°ì„ ìœ„í•œ íš¨ê³¼ìŒ (ì‹¤ì œë¡œëŠ” Web Audio API ì‚¬ìš©)
            playSuccessSound();
        }

        // ë‹¤ì‹œí•˜ê¸°
        function retryActivity() {
            repeatCount = 0;
            document.getElementById('tutorMessage').innerHTML = 
                `ğŸ‘ ë‹¤ì‹œ ë„ì „í•˜ëŠ” ëª¨ìŠµì´ ë©‹ì ¸ìš”! ì²œì²œíˆ í•´ë³´ì„¸ìš”. ì‹¤ìˆ˜í•´ë„ ê´œì°®ì•„ìš”! ğŸ’ª`;
            
            // í˜„ì¬ í™œë™ ì´ˆê¸°í™”
            if (currentTab === 'writing') {
                clearCanvas();
            }
        }

        // ë‹¤ìŒ í™œë™
        function nextActivity() {
            currentWordIndex = (currentWordIndex + 1) % wordList.length;
            currentWord = wordList[currentWordIndex];
            
            // ë‹¨ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸
            document.getElementById('currentWord').textContent = currentWord;
            
            // ë°˜ë³µ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            repeatCount = 0;
            
            // ìƒˆë¡œìš´ ë‹¨ì–´ì— ëŒ€í•œ ì•ˆë‚´
            document.getElementById('tutorMessage').innerHTML = 
                `ğŸ¯ ìƒˆë¡œìš´ ë‹¨ì–´ì˜ˆìš”! ì´ë²ˆì—ëŠ” "${currentWord}"ë¥¼ ë°°ì›Œë´ìš”! ìƒˆë¡œìš´ ë„ì „ì„ ì‹œì‘í•´ë´ìš”! ğŸš€`;
            
            // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
            updateProgress();
            
            // ìë™ìœ¼ë¡œ ë‹¨ì–´ ë°œìŒ
            setTimeout(() => {
                playAudio();
            }, 1000);
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            const totalProgress = Object.values(learningProgress).reduce((a, b) => a + b, 0) / 4;
            const progressElement = document.querySelector('.progress-circle');
            progressElement.textContent = Math.min(100, Math.round(totalProgress)) + '%';
            
            // ì§„í–‰ë¥ ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
            if (totalProgress >= 80) {
                progressElement.style.background = 'conic-gradient(#22c55e ' + totalProgress + '%, rgba(255,255,255,0.3) ' + totalProgress + '%)';
            } else if (totalProgress >= 50) {
                progressElement.style.background = 'conic-gradient(#f59e0b ' + totalProgress + '%, rgba(255,255,255,0.3) ' + totalProgress + '%)';
            }
        }

        // ì„±ê³µ íš¨ê³¼ìŒ ì¬ìƒ
        function playSuccessSound() {
            // ì‹¤ì œë¡œëŠ” Web Audio APIë¥¼ ì‚¬ìš©í•˜ì—¬ íš¨ê³¼ìŒ ì¬ìƒ
            console.log('ì„±ê³µ íš¨ê³¼ìŒ ì¬ìƒ');
        }

        // AI íŠœí„° ë„ì›€ë§
        function getTutorHelp() {
            const helpMessages = {
                reading: `ğŸ“– ì½ê¸° ë„ì›€ë§:\n1. ğŸ”Š ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ë‹¨ì–´ë¥¼ ë“¤ì–´ë³´ì„¸ìš”\n2. ì—¬ëŸ¬ ë²ˆ ë“¤ì–´ë„ ê´œì°®ì•„ìš”\n3. ë”°ë¼ ì½ê¸°ë¥¼ í•´ë³´ì„¸ìš”\n4. í‹€ë ¤ë„ ê´œì°®ìœ¼ë‹ˆ ìì‹ ê° ìˆê²Œ í•˜ì„¸ìš”!`,
                writing: `âœï¸ ì“°ê¸° ë„ì›€ë§:\n1. í™”ë©´ì— ì†ê°€ë½ìœ¼ë¡œ ê¸€ìë¥¼ ì¨ë³´ì„¸ìš”\n2. ì²œì²œíˆ ë”°ë¼ ì¨ë„ ê´œì°®ì•„ìš”\n3. ì˜ëª» ì¼ìœ¼ë©´ ì§€ìš°ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”\n4. ë°˜ë³µ ì—°ìŠµì´ ì¤‘ìš”í•´ìš”!`,
                listening: `ğŸ‘‚ ë“£ê¸° ë„ì›€ë§:\n1. â–¶ï¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ë‹¨ì–´ë¥¼ ë“¤ì–´ë³´ì„¸ìš”\n2. ì—¬ëŸ¬ ë²ˆ ë“¤ì„ ìˆ˜ ìˆì–´ìš”\n3. ë“¤ì€ ë‹¨ì–´ë¥¼ ì•„ë˜ì—ì„œ ì„ íƒí•˜ì„¸ìš”\n4. ì§‘ì¤‘í•´ì„œ ë“¤ì–´ë³´ì„¸ìš”!`,
                speaking: `ğŸ—£ï¸ ë§í•˜ê¸° ë„ì›€ë§:\n1. ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”\n2. í¬ê³  ë˜ë ·í•˜ê²Œ ë§í•´ë³´ì„¸ìš”\n3. ë°œìŒì´ ì¡°ê¸ˆ ë‹¤ë¥´ë”ë¼ë„ ê´œì°®ì•„ìš”\n4. ìì‹ ê° ìˆê²Œ ë§í•˜ëŠ” ê²Œ ì¤‘ìš”í•´ìš”!`
            };
            
            document.getElementById('tutorMessage').innerHTML = helpMessages[currentTab];
        }

        // ì§€ì‹œì‚¬í•­ ë‹¤ì‹œ ë“£ê¸°
        function repeatInstruction() {
            updateTutorMessage(currentTab);
            
            // ìŒì„±ìœ¼ë¡œ ì§€ì‹œì‚¬í•­ ì½ì–´ì£¼ê¸° (ì‹¤ì œë¡œëŠ” TTS ì‚¬ìš©)
            if ('speechSynthesis' in window) {
                const message = document.getElementById('tutorMessage').textContent;
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.7; // ë” ì²œì²œíˆ
                speechSynthesis.speak(utterance);
            }
        }

        // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸° ê¸°ëŠ¥ ì´ˆê¸°í™”
        function initCanvas() {
            const canvas = document.getElementById('writingCanvas');
            const ctx = canvas.getContext('2d');
            
            // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            // ê·¸ë¦¬ê¸° ì„¤ì •
            ctx.strokeStyle = '#3b82f6';
            ctx.lineWidth = 8;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ ì§€ì›)
            canvas.addEventListener('touchstart', handleTouch);
            canvas.addEventListener('touchmove', handleTouch);
            canvas.addEventListener('touchend', stopDrawing);

            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getMousePos(e);
            }

            function draw(e) {
                if (!isDrawing) return;
                
                const [currentX, currentY] = getMousePos(e);
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                
                [lastX, lastY] = [currentX, currentY];
            }

            function stopDrawing() {
                isDrawing = false;
            }

            function getMousePos(e) {
                const rect = canvas.getBoundingClientRect();
                return [
                    e.clientX - rect.left,
                    e.clientY - rect.top
                ];
            }

            function handleTouch(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                                  e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            }
        }

        // í‚¤ë³´ë“œ ì ‘ê·¼ì„± ì§€ì›
        function initKeyboardSupport() {
            document.addEventListener('keydown', (e) => {
                // ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ì˜¤ë””ì˜¤ ì¬ìƒ
                if (e.code === 'Space' && currentTab === 'reading') {
                    e.preventDefault();
                    playAudio();
                }
                
                // ìˆ«ì í‚¤ë¡œ íƒ­ ì „í™˜
                if (e.code >= 'Digit1' && e.code <= 'Digit4') {
                    const tabs = ['reading', 'writing', 'listening', 'speaking'];
                    const tabIndex = parseInt(e.code.slice(-1)) - 1;
                    if (tabs[tabIndex]) {
                        switchTab(tabs[tabIndex]);
                    }
                }
                
                // Enterë¡œ ë‹¤ìŒ í™œë™
                if (e.code === 'Enter') {
                    nextActivity();
                }
                
                // ESCë¡œ ë‹¤ì‹œí•˜ê¸°
                if (e.code === 'Escape') {
                    retryActivity();
                }
            });
        }

        // ë°˜ë³µ í•™ìŠµ ì•Œê³ ë¦¬ì¦˜ (ê°„ê²© ë°˜ë³µ)
        class SpacedRepetition {
            constructor() {
                this.intervals = [1, 3, 7, 14, 30]; // ë¶„ ë‹¨ìœ„
                this.wordData = {};
            }

            // ë‹¨ì–´ í•™ìŠµ ê¸°ë¡
            recordLearning(word, correct) {
                if (!this.wordData[word]) {
                    this.wordData[word] = {
                        level: 0,
                        lastReview: new Date(),
                        correctCount: 0,
                        totalCount: 0
                    };
                }

                const data = this.wordData[word];
                data.totalCount++;
                
                if (correct) {
                    data.correctCount++;
                    data.level = Math.min(data.level + 1, this.intervals.length - 1);
                } else {
                    data.level = Math.max(0, data.level - 1);
                }
                
                data.lastReview = new Date();
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ì‹¤ì œë¡œëŠ” ì„œë²„ DB)
                localStorage.setItem('wordData', JSON.stringify(this.wordData));
            }

            // ë‹¤ìŒ ë³µìŠµ ì‹œê°„ ê³„ì‚°
            getNextReviewTime(word) {
                const data = this.wordData[word];
                if (!data) return new Date();
                
                const interval = this.intervals[data.level] * 60 * 1000; // ë°€ë¦¬ì´ˆ ë³€í™˜
                return new Date(data.lastReview.getTime() + interval);
            }

            // ë³µìŠµì´ í•„ìš”í•œ ë‹¨ì–´ ëª©ë¡
            getWordsForReview() {
                const now = new Date();
                return Object.keys(this.wordData).filter(word => {
                    return this.getNextReviewTime(word) <= now;
                });
            }
        }

        // ì „ì—­ ë°˜ë³µ í•™ìŠµ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        const spacedRepetition = new SpacedRepetition();

        // ì ‘ê·¼ì„± ì„¤ì •
        function initAccessibility() {
            // ê³ ëŒ€ë¹„ ëª¨ë“œ ê°ì§€
            if (window.matchMedia && window.matchMedia('(prefers-contrast: high)').matches) {
                document.body.classList.add('high-contrast');
            }

            // ì• ë‹ˆë©”ì´ì…˜ ê°ì†Œ ëª¨ë“œ ê°ì§€
            if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.body.classList.add('reduced-motion');
            }

            // í°íŠ¸ í¬ê¸° ì¡°ì ˆ ê¸°ëŠ¥
            const fontSizeSlider = document.createElement('input');
            fontSizeSlider.type = 'range';
            fontSizeSlider.min = '14';
            fontSizeSlider.max = '24';
            fontSizeSlider.value = '18';
            fontSizeSlider.style.position = 'fixed';
            fontSizeSlider.style.bottom = '20px';
            fontSizeSlider.style.left = '20px';
            fontSizeSlider.style.zIndex = '1001';
            
            fontSizeSlider.addEventListener('input', (e) => {
                document.body.style.fontSize = e.target.value + 'px';
            });
            
            document.body.appendChild(fontSizeSlider);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            initCanvas();
            initKeyboardSupport();
            initAccessibility();
            
            // ì²« ë‹¨ì–´ ë°œìŒ
            setTimeout(() => {
                playAudio();
            }, 1000);
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í•™ìŠµ ë°ì´í„° ë³µì›
            const savedData = localStorage.getItem('wordData');
            if (savedData) {
                spacedRepetition.wordData = JSON.parse(savedData);
            }
        });

        // í•™ìŠµ ì„¸ì…˜ ì¢…ë£Œ ì‹œ ë°ì´í„° ì €ì¥
        window.addEventListener('beforeunload', () => {
            localStorage.setItem('learningProgress', JSON.stringify(learningProgress));
        });
    </script>
</body>
</html>