<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>í•œê¸€ì´ì™€ í•¨ê»˜ - ë§í•˜ê¸° í•™ìŠµ íŠ¹í™”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            font-size: 18px;
            color: #1e293b;
            overflow: hidden;
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 3fr;
            height: 100vh;
            gap: 25px;
            padding: 25px;
            max-width: 1600px;
            margin: 0 auto;
        }

        /* AI íŠœí„° ì‚¬ì´ë“œë°” */
        .ai-tutor-sidebar {
            background: white;
            border-radius: 25px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
            border: 4px solid #3b82f6;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-width: 350px;
        }

        .tutor-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .tutor-avatar {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            border: 4px solid #60a5fa;
            animation: gentle-bounce 3s ease-in-out infinite;
        }

        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .tutor-name {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .tutor-status {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ì„¤ì • í† ê¸€ ë²„íŠ¼ */
        .settings-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-toggle:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(45deg);
        }

        .tutor-body {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .tutor-message {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 18px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #3b82f6;
            font-size: 16px;
            line-height: 1.5;
            min-height: 120px;
            display: flex;
            align-items: center;
        }

        /* ì„¤ì • íŒ¨ë„ (í† ê¸€) */
        .settings-panel {
            background: #f8fafc;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e2e8f0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .settings-panel.expanded {
            max-height: 400px;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #d1d5db;
        }

        .settings-title {
            font-size: 16px;
            font-weight: bold;
            color: #374151;
        }

        .level-selector {
            margin-bottom: 15px;
        }

        .level-title {
            font-size: 14px;
            font-weight: bold;
            color: #374151;
            margin-bottom: 8px;
        }

        .level-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
        }

        .level-btn {
            padding: 8px 10px;
            border: none;
            border-radius: 8px;
            background: white;
            border: 2px solid #d1d5db;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .level-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .repeat-settings {
            display: flex;
            gap: 15px;
        }

        .setting-group {
            flex: 1;
        }

        .setting-label {
            font-size: 12px;
            font-weight: bold;
            color: #374151;
            margin-bottom: 6px;
            display: block;
        }

        .setting-controls {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .repeat-counter {
            background: white;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 14px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        .adjust-btn {
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 6px;
            background: #3b82f6;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }

        /* í•™ìŠµ ì§„í–‰ ìƒíƒœ */
        .progress-section {
            background: #f8fafc;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            border: 2px solid #e2e8f0;
        }

        .progress-header {
            font-size: 16px;
            font-weight: bold;
            color: #374151;
            margin-bottom: 12px;
        }

        .current-item-info {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid #3b82f6;
        }

        .item-progress {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .repeat-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f0f9ff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
        }

        .stats-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            background: white;
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #3b82f6;
        }

        .stat-label {
            font-size: 12px;
            color: #6b7280;
        }

        .tutor-controls {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .tutor-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 10px;
            background: #3b82f6;
            color: white;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tutor-btn:active {
            transform: scale(0.95);
        }

        /* ë©”ì¸ í•™ìŠµ ì˜ì—­ */
        .main-learning-area {
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border: 3px solid #e2e8f0;
            display: flex;
            flex-direction: column;
        }

        .learning-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 20px;
            color: white;
        }

        .lesson-info h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .lesson-info p {
            font-size: 16px;
            opacity: 0.9;
        }

        .speaking-status {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mic-status {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .mic-status.listening {
            background: #ef4444;
            animation: pulse 1.5s ease-in-out infinite;
        }

        .mic-status.success {
            background: #22c55e;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .learning-content {
            flex: 1;
            background: #f8fafc;
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 500px;
            text-align: center;
        }

        /* í•™ìŠµ ì½˜í…ì¸  */
        .speaking-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .target-display {
            background: white;
            border-radius: 20px;
            padding: 30px;
            border: 4px solid #10b981;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            min-width: 300px;
        }

        .target-letter {
            font-size: 120px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 15px;
        }

        .target-info {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .pronunciation-guide {
            font-size: 24px;
            font-weight: bold;
            color: #10b981;
        }

        /* ì‹œê°ì  íŒíŠ¸ */
        .visual-hint {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #f59e0b;
            max-width: 400px;
        }

        .hint-title {
            font-size: 16px;
            font-weight: bold;
            color: #d97706;
            margin-bottom: 15px;
        }

        .hint-content {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .hint-image {
            width: 80px;
            height: 80px;
            font-size: 50px;
            background: #fef3c7;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #f59e0b;
        }

        .hint-text {
            flex: 1;
            text-align: left;
        }

        .hint-example {
            font-size: 18px;
            font-weight: bold;
            color: #92400e;
            margin-bottom: 5px;
        }

        .hint-description {
            font-size: 14px;
            color: #78716c;
        }

        /* ìŒì„± ì¸ì‹ ì˜ì—­ */
        .voice-recognition {
            background: white;
            border-radius: 15px;
            padding: 25px;
            border: 3px solid #3b82f6;
            max-width: 500px;
        }

        .mic-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto 20px;
            display: block;
        }

        .mic-button:hover {
            transform: scale(1.05);
        }

        .mic-button.listening {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            animation: pulse 1.5s ease-in-out infinite;
        }

        .mic-button.success {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }

        .voice-instruction {
            font-size: 18px;
            font-weight: bold;
            color: #374151;
            margin-bottom: 10px;
        }

        .voice-feedback {
            font-size: 16px;
            color: #6b7280;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .recognized-text {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border: 2px solid #3b82f6;
            font-size: 18px;
            font-weight: bold;
            color: #1e40af;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ë“¤ */
        .action-controls {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .action-btn {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.play-sound {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
        }

        .action-btn.retry {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .action-btn.next {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        /* í”¼ë“œë°± ì˜¤ë²„ë ˆì´ */
        .feedback-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .feedback-content {
            background: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }

        .feedback-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .feedback-text {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .feedback-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            background: #10b981;
            color: white;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr 2fr;
                gap: 20px;
                padding: 20px;
            }
        }

        @media (max-width: 900px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
                gap: 15px;
                padding: 15px;
            }
            
            .ai-tutor-sidebar {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- AI íŠœí„° ì‚¬ì´ë“œë°” -->
        <div class="ai-tutor-sidebar">
            <div class="tutor-header">
                <button class="settings-toggle" onclick="toggleSettings()">âš™ï¸</button>
                <div class="tutor-avatar">ğŸ¤–</div>
                <div class="tutor-name">AI ë§í•˜ê¸° ì„ ìƒë‹˜</div>
                <div class="tutor-status">ë°œìŒ ì—°ìŠµí•´ìš”!</div>
            </div>
            <div class="tutor-body">
                <div class="tutor-message" id="tutorMessage">
                    ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ í•œê¸€ ë°œìŒì„ ì—°ìŠµí•˜ëŠ” ì‹œê°„ì´ì—ìš”. 
                    ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  í™”ë©´ì— ë‚˜ì˜¨ ê¸€ìë¥¼ ì†Œë¦¬ë‚´ì–´ ì½ì–´ë³´ì„¸ìš”! ğŸ¤âœ¨
                </div>
                
                <!-- ì„¤ì • íŒ¨ë„ (í† ê¸€) -->
                <div class="settings-panel" id="settingsPanel">
                    <div class="settings-header">
                        <div class="settings-title">âš™ï¸ í•™ìŠµ ì„¤ì •</div>
                    </div>
                    
                    <!-- í•™ìŠµ ë ˆë²¨ ì„ íƒ -->
                    <div class="level-selector">
                        <div class="level-title">ğŸ“š í•™ìŠµ ë‹¨ê³„</div>
                        <div class="level-buttons">
                            <button class="level-btn active" onclick="selectLevel('consonant')">ììŒ</button>
                            <button class="level-btn" onclick="selectLevel('vowel')">ëª¨ìŒ</button>
                            <button class="level-btn" onclick="selectLevel('combination')">ê¸€ì</button>
                            <button class="level-btn" onclick="selectLevel('word')">ë‹¨ì–´</button>
                        </div>
                    </div>
                    
                    <!-- ë°˜ë³µ ì„¤ì • -->
                    <div class="repeat-settings">
                        <div class="setting-group">
                            <label class="setting-label">ì„±ê³µ ë°˜ë³µ</label>
                            <div class="setting-controls">
                                <button class="adjust-btn" onclick="adjustRepeat('correct', -1)">-</button>
                                <div class="repeat-counter" id="correctRepeat">3</div>
                                <button class="adjust-btn" onclick="adjustRepeat('correct', 1)">+</button>
                            </div>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">ì‹¤íŒ¨ ë°˜ë³µ</label>
                            <div class="setting-controls">
                                <button class="adjust-btn" onclick="adjustRepeat('incorrect', -1)">-</button>
                                <div class="repeat-counter" id="incorrectRepeat">5</div>
                                <button class="adjust-btn" onclick="adjustRepeat('incorrect', 1)">+</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- í•™ìŠµ ì§„í–‰ ìƒíƒœ -->
                <div class="progress-section">
                    <div class="progress-header">ğŸ“Š í•™ìŠµ ì§„í–‰ ìƒíƒœ</div>
                    <div class="current-item-info">
                        <div class="item-progress" id="itemProgress">ììŒ 'ã„±' (1/10)</div>
                        <div class="repeat-status">
                            <span>í˜„ì¬ ë°˜ë³µ:</span>
                            <span id="currentRepeat">1/3</span>
                        </div>
                    </div>
                    <div class="stats-display">
                        <div class="stat-item">
                            <div class="stat-value" id="correctCount">0</div>
                            <div class="stat-label">ì •ë‹µ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="incorrectCount">0</div>
                            <div class="stat-label">ì˜¤ë‹µ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgTime">0.0s</div>
                            <div class="stat-label">í‰ê· ì‹œê°„</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="accuracy">100%</div>
                            <div class="stat-label">ì •í™•ë„</div>
                        </div>
                    </div>
                </div>
                
                <div class="tutor-controls">
                    <button class="tutor-btn" onclick="getTutorHelp()">ğŸ’¡ ë„ì›€</button>
                    <button class="tutor-btn" onclick="repeatInstruction()">ğŸ”Š ì•ˆë‚´</button>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ í•™ìŠµ ì˜ì—­ -->
        <div class="main-learning-area">
            <!-- ìƒë‹¨ í—¤ë” -->
            <div class="learning-header">
                <div class="lesson-info">
                    <h1 id="lessonTitle">ğŸ—£ï¸ ë§í•˜ê¸° ì—°ìŠµ</h1>
                    <p id="lessonSubtitle">ììŒ ë°œìŒ ì—°ìŠµí•˜ê¸°</p>
                </div>
                <div class="speaking-status">
                    <div class="mic-status" id="micStatus">ğŸ¤</div>
                </div>
            </div>

            <!-- í•™ìŠµ ì½˜í…ì¸  ì˜ì—­ -->
            <div class="learning-content">
                <div class="speaking-area">
                    <!-- í•™ìŠµ ëŒ€ìƒ í‘œì‹œ -->
                    <div class="target-display">
                        <div class="target-letter" id="targetLetter">ã„±</div>
                        <div class="target-info" id="targetInfo">ê¸°ì—­</div>
                        <div class="pronunciation-guide" id="pronunciationGuide">[ã„±]</div>
                    </div>

                    <!-- ì‹œê°ì  íŒíŠ¸ -->
                    <div class="visual-hint">
                        <div class="hint-title">ğŸ–¼ï¸ ê¸°ì–µí•˜ëŠ” íŒíŠ¸</div>
                        <div class="hint-content">
                            <div class="hint-image" id="hintImage">ğŸ±</div>
                            <div class="hint-text">
                                <div class="hint-example" id="hintExample">ê³ ì–‘ì´ì˜ 'ã„±'</div>
                                <div class="hint-description" id="hintDescription">ê³ ì–‘ì´ê°€ ìš¸ ë•Œ ë‚˜ëŠ” ì†Œë¦¬ë¥¼ ìƒê°í•´ë³´ì„¸ìš”</div>
                            </div>
                        </div>
                    </div>

                    <!-- ìŒì„± ì¸ì‹ ì˜ì—­ -->
                    <div class="voice-recognition">
                        <button class="mic-button" id="micButton" onclick="toggleRecording()">ğŸ¤</button>
                        <div class="voice-instruction" id="voiceInstruction">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë§í•´ë³´ì„¸ìš”</div>
                        <div class="voice-feedback" id="voiceFeedback">ìŒì„± ì¸ì‹ ì¤€ë¹„ ì¤‘...</div>
                        <div class="recognized-text" id="recognizedText" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <!-- í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
            <div class="action-controls">
                <button class="action-btn play-sound" onclick="playTargetSound()">ğŸ”Š ë“¤ì–´ë³´ê¸°</button>
                <button class="action-btn retry" onclick="retryPronunciation()">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
                <button class="action-btn next" onclick="nextItem()">â¡ï¸ ë‹¤ìŒ ë¬¸ì œ</button>
            </div>
        </div>
    </div>

    <!-- í”¼ë“œë°± ì˜¤ë²„ë ˆì´ -->
    <div class="feedback-overlay" id="feedbackOverlay">
        <div class="feedback-content">
            <div class="feedback-icon" id="feedbackIcon">ğŸ‰</div>
            <div class="feedback-text" id="feedbackText">ì •ë§ ì˜í–ˆì–´ìš”!</div>
            <button class="feedback-btn" onclick="closeFeedback()">ê³„ì†í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // ì „ì—­ ìƒíƒœ ê´€ë¦¬
        let currentLevel = 'consonant';
        let currentItemIndex = 0;
        let currentRepeat = 1;
        let maxRepeat = 3;
        let isRecording = false;
        let recognition = null;
        let startTime = null;
        
        // ë°˜ë³µ ì„¤ì •
        let repeatSettings = {
            correct: 3,
            incorrect: 5
        };
        
        // í•™ìŠµ ë°ì´í„° ë¶„ì„ìš©
        let learningStats = {
            sessionStart: new Date(),
            attempts: [],
            stats: {
                totalCorrect: 0,
                totalIncorrect: 0,
                totalTime: 0,
                currentStreak: 0,
                bestStreak: 0
            }
        };
        
        // í•™ìŠµ ì½˜í…ì¸  ë°ì´í„°ë² ì´ìŠ¤
        const learningData = {
            consonant: [
                { letter: 'ã„±', name: 'ê¸°ì—­', sound: '[ã„±]', example: 'ê³ ì–‘ì´ì˜ ã„±', image: 'ğŸ±' },
            ],
            vowel: [
                { letter: 'ã…', name: 'ì•„', sound: '[ì•„]', example: 'ì•„ê¸°ì˜ ã…', image: 'ğŸ‘¶' },
            ],
            combination: [
                { consonant: 'ã„±', vowel: 'ã…', result: 'ê°€', meaning: 'ê°€ë°©ì˜ ê°€', image: 'ğŸ’' },
            ],
            word: [
                { word: 'ê°€ë°©', syllables: ['ê°€', 'ë°©'], image: 'ğŸ’', meaning: 'ì±…ì„ ë„£ëŠ” ê²ƒ' },
            ]
        };

        // ìŒì„± ì¸ì‹ ì´ˆê¸°í™”
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
            } else if ('SpeechRecognition' in window) {
                recognition = new SpeechRecognition();
            } else {
                updateVoiceFeedback('ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.');
                return false;
            }

            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'ko-KR';

            recognition.onstart = function() {
                isRecording = true;
                startTime = new Date();
                updateMicStatus('listening');
                updateVoiceFeedback('ë“£ê³  ìˆìŠµë‹ˆë‹¤... ë§í•´ë³´ì„¸ìš”!');
            };

            recognition.onresult = function(event) {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                if (finalTranscript) {
                    processVoiceInput(finalTranscript.trim());
                } else if (interimTranscript) {
                    updateRecognizedText(interimTranscript);
                }
            };

            recognition.onerror = function(event) {
                isRecording = false;
                updateMicStatus('error');
                updateVoiceFeedback('ìŒì„± ì¸ì‹ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            };

            recognition.onend = function() {
                isRecording = false;
                updateMicButton();
            };

            return true;
        }

        // ìŒì„± ì…ë ¥ ì²˜ë¦¬
        function processVoiceInput(input) {
            const endTime = new Date();
            const responseTime = (endTime - startTime) / 1000;
            
            const currentItem = getCurrentItem();
            const targetText = getTargetText(currentItem);
            
            // ì •ë‹µ íŒì • (ìœ ì‚¬ë„ ê²€ì‚¬)
            const isCorrect = checkPronunciation(input, targetText);
            
            // í•™ìŠµ ë°ì´í„° ì €ì¥
            recordAttempt(input, targetText, isCorrect, responseTime);
            
            updateRecognizedText(input);
            
            if (isCorrect) {
                handleCorrectAnswer(responseTime);
            } else {
                handleIncorrectAnswer(input, targetText);
            }
        }

        // ë°œìŒ ì •í™•ë„ ê²€ì‚¬
        function checkPronunciation(input, target) {
            // í•œê¸€ ë°œìŒ ìœ ì‚¬ë„ ê²€ì‚¬ ë¡œì§
            const normalizedInput = input.replace(/\s+/g, '').toLowerCase();
            const normalizedTarget = target.replace(/\s+/g, '').toLowerCase();
            
            // ì§ì ‘ ì¼ì¹˜
            if (normalizedInput === normalizedTarget) return true;
            
            // ë¶€ë¶„ ì¼ì¹˜ (70% ì´ìƒ)
            const similarity = calculateSimilarity(normalizedInput, normalizedTarget);
            return similarity >= 0.7;
        }

        // ë¬¸ìì—´ ìœ ì‚¬ë„ ê³„ì‚°
        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = getEditDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        // í¸ì§‘ ê±°ë¦¬ ê³„ì‚° (Levenshtein Distance)
        function getEditDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        // í•™ìŠµ ì‹œë„ ê¸°ë¡
        function recordAttempt(input, target, isCorrect, responseTime) {
            const attempt = {
                timestamp: new Date(),
                level: currentLevel,
                itemIndex: currentItemIndex,
                target: target,
                input: input,
                isCorrect: isCorrect,
                responseTime: responseTime,
                repeatCount: currentRepeat
            };
            
            learningStats.attempts.push(attempt);
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            if (isCorrect) {
                learningStats.stats.totalCorrect++;
                learningStats.stats.currentStreak++;
                learningStats.stats.bestStreak = Math.max(
                    learningStats.stats.bestStreak, 
                    learningStats.stats.currentStreak
                );
            } else {
                learningStats.stats.totalIncorrect++;
                learningStats.stats.currentStreak = 0;
            }
            
            learningStats.stats.totalTime += responseTime;
            updateStatsDisplay();
        }

        // í†µê³„ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateStatsDisplay() {
            const stats = learningStats.stats;
            const totalAttempts = stats.totalCorrect + stats.totalIncorrect;
            const accuracy = totalAttempts > 0 ? (stats.totalCorrect / totalAttempts * 100) : 100;
            const avgTime = totalAttempts > 0 ? (stats.totalTime / totalAttempts) : 0;
            
            document.getElementById('correctCount').textContent = stats.totalCorrect;
            document.getElementById('incorrectCount').textContent = stats.totalIncorrect;
            document.getElementById('accuracy').textContent = accuracy.toFixed(1) + '%';
            document.getElementById('avgTime').textContent = avgTime.toFixed(1) + 's';
        }

        // ì •ë‹µ ì²˜ë¦¬
        function handleCorrectAnswer(responseTime) {
            updateMicStatus('success');
            updateVoiceFeedback(`ì •ë‹µì…ë‹ˆë‹¤! (${responseTime.toFixed(1)}ì´ˆ)`);
            
            if (currentRepeat >= maxRepeat) {
                setTimeout(() => {
                    showFeedback(true, true);
                    nextItem();
                }, 1500);
            } else {
                currentRepeat++;
                updateRepeatDisplay();
                setTimeout(() => {
                    showFeedback(true, false);
                    generateRandomHint();
                }, 1500);
            }
        }

        // ì˜¤ë‹µ ì²˜ë¦¬
        function handleIncorrectAnswer(input, target) {
            updateMicStatus('error');
            updateVoiceFeedback(`ë‹¤ì‹œ í•´ë³´ì„¸ìš”. "${target}"ë¼ê³  ë§í•´ë³´ì„¸ìš”.`);
            
            maxRepeat = repeatSettings.incorrect;
            updateRepeatDisplay();
            
            setTimeout(() => {
                showFeedback(false, false);
                updateMicStatus('ready');
            }, 2000);
        }

        // í˜„ì¬ í•™ìŠµ í•­ëª© ê°€ì ¸ì˜¤ê¸°
        function getCurrentItem() {
            return learningData[currentLevel][currentItemIndex];
        }

        // ëª©í‘œ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        function getTargetText(item) {
            switch(currentLevel) {
                case 'consonant':
                case 'vowel':
                    return item.letter;
                case 'combination':
                    return item.result;
                case 'word':
                    return item.word;
                default:
                    return '';
            }
        }

        // ëœë¤ íŒíŠ¸ ìƒì„±
        function generateRandomHint() {
            const currentItem = getCurrentItem();
            const hints = currentItem.hints;
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            
            document.getElementById('hintImage').textContent = randomHint.image;
            document.getElementById('hintExample').textContent = randomHint.example;
            document.getElementById('hintDescription').textContent = randomHint.description;
            
            updateTutorMessage('ğŸ¯ ìƒˆë¡œìš´ íŒíŠ¸!', 
                `ì´ë²ˆì—ëŠ” "${randomHint.example}"ë¥¼ ìƒê°í•˜ë©° ë°œìŒí•´ë³´ì„¸ìš”! ${randomHint.description} ğŸª`);
        }

        // UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        function updateMicStatus(status) {
            const micStatus = document.getElementById('micStatus');
            const micButton = document.getElementById('micButton');
            
            micStatus.className = 'mic-status';
            micButton.className = 'mic-button';
            
            switch(status) {
                case 'listening':
                    micStatus.classList.add('listening');
                    micButton.classList.add('listening');
                    micStatus.textContent = 'ğŸ”´';
                    micButton.textContent = 'ğŸ”´';
                    break;
                case 'success':
                    micStatus.classList.add('success');
                    micButton.classList.add('success');
                    micStatus.textContent = 'âœ…';
                    micButton.textContent = 'âœ…';
                    break;
                case 'error':
                    micStatus.textContent = 'âŒ';
                    micButton.textContent = 'âŒ';
                    break;
                default:
                    micStatus.textContent = 'ğŸ¤';
                    micButton.textContent = 'ğŸ¤';
            }
        }

        function updateMicButton() {
            const micButton = document.getElementById('micButton');
            if (isRecording) {
                micButton.classList.add('listening');
                micButton.textContent = 'ğŸ”´';
            } else {
                micButton.classList.remove('listening');
                micButton.textContent = 'ğŸ¤';
            }
        }

        function updateVoiceFeedback(message) {
            document.getElementById('voiceFeedback').textContent = message;
        }

        function updateRecognizedText(text) {
            const element = document.getElementById('recognizedText');
            element.textContent = `ì¸ì‹ëœ ìŒì„±: "${text}"`;
            element.style.display = 'block';
        }

        function updateRepeatDisplay() {
            document.getElementById('currentRepeat').textContent = `${currentRepeat}/${maxRepeat}`;
        }

        function updateProgressDisplay() {
            const total = learningData[currentLevel].length;
            const levelNames = {
                consonant: 'ììŒ',
                vowel: 'ëª¨ìŒ', 
                combination: 'ê¸€ì',
                word: 'ë‹¨ì–´'
            };
            
            const currentItem = getCurrentItem();
            const targetText = getTargetText(currentItem);
            
            document.getElementById('itemProgress').textContent = 
                `${levelNames[currentLevel]} '${targetText}' (${currentItemIndex + 1}/${total})`;
        }

        // ë ˆë²¨ ì„ íƒ
        function selectLevel(level) {
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentLevel = level;
            currentItemIndex = 0;
            resetItemState();
            updateContent();
            updateProgressDisplay();
        }

        // í•­ëª© ìƒíƒœ ë¦¬ì…‹
        function resetItemState() {
            currentRepeat = 1;
            maxRepeat = repeatSettings.correct;
            updateRepeatDisplay();
            updateMicStatus('ready');
            document.getElementById('recognizedText').style.display = 'none';
        }

        // ì½˜í…ì¸  ì—…ë°ì´íŠ¸
        function updateContent() {
            const currentItem = getCurrentItem();
            const targetText = getTargetText(currentItem);
            
            // ê¸°ë³¸ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('targetLetter').textContent = targetText;
            
            switch(currentLevel) {
                case 'consonant':
                case 'vowel':
                    document.getElementById('targetInfo').textContent = currentItem.name;
                    document.getElementById('pronunciationGuide').textContent = currentItem.sound;
                    break;
                case 'combination':
                    document.getElementById('targetInfo').textContent = 
                        `${currentItem.consonant} + ${currentItem.vowel}`;
                    document.getElementById('pronunciationGuide').textContent = currentItem.sound;
                    break;
                case 'word':
                    document.getElementById('targetInfo').textContent = 
                        currentItem.syllables.join(' + ');
                    document.getElementById('pronunciationGuide').textContent = currentItem.sound;
                    break;
            }
            
            // ì²« ë²ˆì§¸ íŒíŠ¸ë¡œ ì„¤ì •
            const firstHint = currentItem.hints[0];
            document.getElementById('hintImage').textContent = firstHint.image;
            document.getElementById('hintExample').textContent = firstHint.example;
            document.getElementById('hintDescription').textContent = firstHint.description;
            
            updateLevelMessage();
        }

        // ë ˆë²¨ë³„ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateLevelMessage() {
            const currentItem = getCurrentItem();
            const targetText = getTargetText(currentItem);
            
            const messages = {
                consonant: {
                    title: 'ğŸ—£ï¸ ììŒ ë°œìŒ ì—°ìŠµ',
                    subtitle: `'${targetText}' ì†Œë¦¬ë‚´ì–´ ì½ê¸°`,
                    message: `ììŒ '${targetText}'ë¥¼ ì •í™•í•˜ê²Œ ë°œìŒí•´ë³´ì„¸ìš”! ${currentItem.name} ì†Œë¦¬ë¥¼ ë˜ë ·í•˜ê²Œ ë§í•´ë³´ì„¸ìš”! ğŸ¤`
                },
                vowel: {
                    title: 'ğŸ—£ï¸ ëª¨ìŒ ë°œìŒ ì—°ìŠµ',
                    subtitle: `'${targetText}' ì†Œë¦¬ë‚´ì–´ ì½ê¸°`,
                    message: `ëª¨ìŒ '${targetText}'ë¥¼ ì •í™•í•˜ê²Œ ë°œìŒí•´ë³´ì„¸ìš”! ${currentItem.name} ì†Œë¦¬ë¥¼ ê¸¸ê²Œ ëŠ˜ì—¬ì„œ ë§í•´ë³´ì„¸ìš”! ğŸµ`
                },
                combination: {
                    title: 'ğŸ—£ï¸ ê¸€ì ë°œìŒ ì—°ìŠµ',
                    subtitle: `'${targetText}' ì†Œë¦¬ë‚´ì–´ ì½ê¸°`,
                    message: `ê¸€ì '${targetText}'ë¥¼ ì •í™•í•˜ê²Œ ë°œìŒí•´ë³´ì„¸ìš”! ${currentItem.consonant}ê³¼ ${currentItem.vowel}ì´ í•©ì³ì§„ ì†Œë¦¬ì˜ˆìš”! âœ¨`
                },
                word: {
                    title: 'ğŸ—£ï¸ ë‹¨ì–´ ë°œìŒ ì—°ìŠµ',
                    subtitle: `'${targetText}' ì†Œë¦¬ë‚´ì–´ ì½ê¸°`,
                    message: `ë‹¨ì–´ '${targetText}'ë¥¼ ì •í™•í•˜ê²Œ ë°œìŒí•´ë³´ì„¸ìš”! ${currentItem.syllables.join('ê³¼ ')}ì„ ì´ì–´ì„œ ë§í•´ë³´ì„¸ìš”! ğŸ†`
                }
            };
            
            const levelInfo = messages[currentLevel];
            document.getElementById('lessonTitle').textContent = levelInfo.title;
            document.getElementById('lessonSubtitle').textContent = levelInfo.subtitle;
            updateTutorMessage(levelInfo.title, levelInfo.message);
        }

        // ì„¤ì • í† ê¸€
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('expanded');
        }

        // ë°˜ë³µ íšŸìˆ˜ ì¡°ì •
        function adjustRepeat(type, delta) {
            const newValue = repeatSettings[type] + delta;
            if (newValue >= 1 && newValue <= 10) {
                repeatSettings[type] = newValue;
                document.getElementById(type + 'Repeat').textContent = newValue;
                
                updateTutorMessage('âš™ï¸ ì„¤ì • ë³€ê²½', 
                    `${type === 'correct' ? 'ì„±ê³µì‹œ' : 'ì‹¤íŒ¨ì‹œ'} ë°˜ë³µ íšŸìˆ˜ê°€ ${newValue}íšŒë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‘`);
            }
        }

        // ìŒì„± ë…¹ìŒ í† ê¸€
        function toggleRecording() {
            if (!recognition) {
                updateVoiceFeedback('ìŒì„± ì¸ì‹ì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            if (isRecording) {
                recognition.stop();
            } else {
                document.getElementById('recognizedText').style.display = 'none';
                recognition.start();
            }
        }

        // ëª©í‘œ ìŒì„± ì¬ìƒ (TTS)
        function playTargetSound() {
            const currentItem = getCurrentItem();
            const targetText = getTargetText(currentItem);
            
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(targetText);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.6;
                utterance.pitch = 1.2;
                speechSynthesis.speak(utterance);
                
                updateTutorMessage('ğŸ”Š ë°œìŒ ë“£ê¸°', 
                    `"${targetText}" ì†Œë¦¬ë¥¼ ì˜ ë“¤ì–´ë³´ì„¸ìš”. ë˜‘ê°™ì´ ë”°ë¼ ë§í•´ë³´ì„¸ìš”! ğŸ§`);
            }
        }

        // ë°œìŒ ì¬ì‹œë„
        function retryPronunciation() {
            resetItemState();
            generateRandomHint();
            updateTutorMessage('ğŸ”„ ë‹¤ì‹œ ë„ì „!', 
                'ê´œì°®ì•„ìš”! ì²œì²œíˆ ë‹¤ì‹œ í•´ë³´ì„¸ìš”. íŒíŠ¸ë¥¼ ì°¸ê³ í•´ì„œ ì •í™•í•˜ê²Œ ë°œìŒí•´ë³´ì„¸ìš”! ğŸ’ª');
        }

        // ë‹¤ìŒ ë¬¸ì œ
        function nextItem() {
            const maxIndex = learningData[currentLevel].length - 1;
            
            if (currentItemIndex < maxIndex) {
                currentItemIndex++;
                resetItemState();
                updateContent();
                updateProgressDisplay();
                generateRandomHint();
            } else {
                showLevelComplete();
            }
        }

        // ë ˆë²¨ ì™„ë£Œ
        function showLevelComplete() {
            const levelNames = {
                consonant: 'ììŒ ë°œìŒ',
                vowel: 'ëª¨ìŒ ë°œìŒ',
                combination: 'ê¸€ì ë°œìŒ',
                word: 'ë‹¨ì–´ ë°œìŒ'
            };
            
            updateTutorMessage('ğŸ† ë‹¨ê³„ ì™„ë£Œ!', 
                `${levelNames[currentLevel]} ì—°ìŠµì„ ëª¨ë‘ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ì •ë§ ëŒ€ë‹¨í•´ìš”! ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ë³¼ê¹Œìš”? ğŸ‰`);
            
            showFeedback(true, true, 'ë‹¨ê³„ ì™„ë£Œ!');
        }

        // í”¼ë“œë°± í‘œì‹œ
        function showFeedback(isCorrect, isComplete, customText = null) {
            const overlay = document.getElementById('feedbackOverlay');
            const icon = document.getElementById('feedbackIcon');
            const text = document.getElementById('feedbackText');
            
            if (customText) {
                icon.textContent = 'ğŸ†';
                text.textContent = customText;
            } else if (isCorrect) {
                if (isComplete) {
                    icon.textContent = 'ğŸ‰';
                    text.textContent = 'ì™„ë²½í•´ìš”! ë‹¤ìŒ ë¬¸ì œë¡œ!';
                } else {
                    icon.textContent = 'âœ¨';
                    text.textContent = 'ì˜í–ˆì–´ìš”! í•œ ë²ˆ ë”!';
                }
            } else {
                icon.textContent = 'ğŸ’ª';
                text.textContent = 'ê´œì°®ì•„ìš”! ë‹¤ì‹œ ë„ì „!';
            }
            
            overlay.style.display = 'flex';
            setTimeout(() => closeFeedback(), 2000);
        }

        // í”¼ë“œë°± ë‹«ê¸°
        function closeFeedback() {
            document.getElementById('feedbackOverlay').style.display = 'none';
        }

        // AI íŠœí„° ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateTutorMessage(title, message) {
            const tutorMessage = document.getElementById('tutorMessage');
            tutorMessage.innerHTML = `<strong>${title}</strong><br><br>${message}`;
        }

        // ë„ì›€ë§
        function getTutorHelp() {
            const helpMessages = {
                consonant: 'ììŒì€ í•œê¸€ì˜ ê¸°ë³¸ ì†Œë¦¬ì˜ˆìš”. ì…ìˆ ê³¼ í˜€ì˜ ìœ„ì¹˜ë¥¼ ë°”ë¥´ê²Œ í•˜ê³  ë˜ë ·í•˜ê²Œ ë°œìŒí•´ë³´ì„¸ìš”!',
                vowel: 'ëª¨ìŒì€ ììŒê³¼ í•¨ê»˜ ì™„ì „í•œ ì†Œë¦¬ë¥¼ ë§Œë“¤ì–´ìš”. ì…ëª¨ì–‘ì„ í¬ê²Œ í•˜ê³  ì†Œë¦¬ë¥¼ ê¸¸ê²Œ ë‚´ë³´ì„¸ìš”!',
                combination: 'ììŒê³¼ ëª¨ìŒì´ í•©ì³ì§„ ì™„ì „í•œ ê¸€ìì˜ˆìš”. ììŒ ì†Œë¦¬ ë’¤ì— ëª¨ìŒ ì†Œë¦¬ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì´ì–´ë³´ì„¸ìš”!',
                word: 'ì™„ì „í•œ ë‹¨ì–´ì˜ˆìš”. ê° ìŒì ˆì„ ë˜ë ·í•˜ê²Œ ë°œìŒí•˜ê³  ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•´ì„œ ë§í•´ë³´ì„¸ìš”!'
            };
            
            updateTutorMessage('ğŸ’¡ ë°œìŒ ë„ì›€ë§', helpMessages[currentLevel]);
        }

        // ì§€ì‹œì‚¬í•­ ë‹¤ì‹œ ë“£ê¸°
        function repeatInstruction() {
            const message = document.getElementById('tutorMessage').textContent;
            
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        // í•™ìŠµ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (ë¶„ì„ìš©)
        function exportlearningStats() {
            const dataToExport = {
                sessionInfo: {
                    startTime: learningStats.sessionStart,
                    endTime: new Date(),
                    totalDuration: (new Date() - learningStats.sessionStart) / 1000
                },
                settings: repeatSettings,
                stats: learningStats.stats,
                attempts: learningStats.attempts
            };
            
            const jsonData = JSON.stringify(dataToExport, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `korean_learning_data_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(event) {
            switch(event.code) {
                case 'Space':
                    event.preventDefault();
                    toggleRecording();
                    break;
                case 'ArrowRight':
                    event.preventDefault();
                    nextItem();
                    break;
                case 'KeyP':
                    event.preventDefault();
                    playTargetSound();
                    break;
                case 'KeyR':
                    event.preventDefault();
                    retryPronunciation();
                    break;
                case 'KeyH':
                    event.preventDefault();
                    getTutorHelp();
                    break;
                case 'KeyS':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        exportlearningStats();
                    }
                    break;
            }
        });

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ìŒì„± ì¸ì‹ ì´ˆê¸°í™”
            if (!initSpeechRecognition()) {
                updateTutorMessage('âš ï¸ ì•Œë¦¼', 
                    'ìŒì„± ì¸ì‹ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤. Chromeì´ë‚˜ Edge ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
            }
            
            // ì´ˆê¸° ì½˜í…ì¸  ì„¤ì •
            selectLevel('consonant');
            updateStatsDisplay();
            
            // í™˜ì˜ ë©”ì‹œì§€
            setTimeout(() => {
                updateTutorMessage('ğŸ‘‹ í™˜ì˜í•©ë‹ˆë‹¤!', 
                    'í•œê¸€ ë°œìŒ ì—°ìŠµì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•´ìš”! ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆ„ë¥´ê±°ë‚˜ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ì„œ ì‹œì‘í•´ë³´ì„¸ìš”! ğŸ¤âœ¨');
            }, 1000);
            
            // ë‹¨ì¶•í‚¤ ì•ˆë‚´
            setTimeout(() => {
                console.log('ğŸ® ë‹¨ì¶•í‚¤ ì•ˆë‚´:');
                console.log('ìŠ¤í˜ì´ìŠ¤ë°”: ìŒì„± ë…¹ìŒ ì‹œì‘/ì¤‘ì§€');
                console.log('â†’: ë‹¤ìŒ ë¬¸ì œ');
                console.log('P: ë°œìŒ ë“£ê¸°');
                console.log('R: ë‹¤ì‹œí•˜ê¸°');
                console.log('H: ë„ì›€ë§');
                console.log('Ctrl+S: í•™ìŠµ ë°ì´í„° ë‚´ë³´ë‚´ê¸°');
            }, 3000);
        });

        // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ í•™ìŠµ ë°ì´í„° ì €ì¥
        window.addEventListener('beforeunload', function() {
            localStorage.setItem('koreanlearningStats', JSON.stringify(learningStats));
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ì „ ë°ì´í„° ë³µì›
        window.addEventListener('load', function() {
            const savedData = localStorage.getItem('koreanlearningStats');
            if (savedData) {
                try {
                    const parsed = JSON.parse(savedData);
                    learningStats.stats = parsed.stats || learningStats.stats;
                    updateStatsDisplay();
                } catch (e) {
                    console.log('ì´ì „ í•™ìŠµ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }
        });
    </script>
</body>
</html>